---
title: http请求
date: 2018-04-29 14:13:56
tags: http, 性能优化
header_img: 
---

# Http请求的全过程

## 首先要了解HTTP请求头和相应头

### HTTP请求request

请求行 请求头 空行 请求数据

#### 请求行

包括请求类型，GET,POST,PUT,DELETE等，请求访问的资源，最后一部分说明使用的版本比如HTTP1.1

#### 请求头部

请求头一般有以下部分组成

- Accept 请求接受类型，比如text/javascript
- Accept-Encoding 压缩格式，比如gzip
- Accept-language 语言，比如zh-CN
- Accept-Charset 接受内容的字符集，utf-8
- Cookie 用来保存一个登陆的用户信息，比如SeesionId 一些用户数据
- Host 请求的主机域名
- Referer 表示请求是从哪个URL来的
- Cache-Control 控制是否需要缓存
- User-Agent 用户代理，操作系统版本，浏览器及版本等
- Connection: keep-alive 长连接HTTP1.1默认自带

websocket 连接 ws/wss

- Connection: Upgrade
- Upgrade: websocket

#### 请求内容

get请求这里为空，post这里存放请求数据

### HTTP响应response

HTTP响应也由四个部分组成💘，分别是：状态行、消息报头、空行和响应正文。

#### 状态行

HTTP/1.1）表明HTTP版本为1.1版本，状态码为200，状态消息为（ok）

#### 消息报头

- Date 相应时间
- Cache-control 缓存控制，max-age 相对过期时间
- Content-Type 内容类型，比如text/html;charset=utf-8
- Expires 过期时间
- Etag 请求变量实体值
- last-Modified 最后修改时间

## 请求过程详解

1. 浏览器会先查询`Cache-Conrol`或者`Expires`，来查内容是否过期，如果未过期直接从缓存读取，不发送HTTP请求。否则进入下一步
2. 进行域名解析，然后解析出端口号，默认80 ，浏览器建立一条与服务器的tcp连接（三次握手）
3. 浏览器判断上次文件返回头中是否含有`Etag`信息，有则带上`if-None-Match`字段信息发送请求给服务端，服务端判断Etag未修改返回304，如果修改就返回200，否则进入下一步
4. 浏览器判断上次文件返回头中是否含有`Last-Modified`，有则带上`if-Modified-Since`字段信息发送请求，服务端判断是否失效，有返回200，有效则返回304

## 服务端返回状态码

- 100：继续。客户端应继续其请求

- 101：切换协议。服务器根据客户端的请求切换协议。只能切换到更高级的协议，例如，切换到HTTP的新版本协议。websocket等

- 200：OK，请求成功
- 201：已创建。成功请求并创建了新的资源
- 202：已接受。已经接受请求，但未处理完成
- 300：重定向，多种选择。请求的资源可包括多个位置，相应可返回一个资源特征与地址的列表用于用户终端（例如：浏览器）选择
- 301：永久移动。请求的资源已被永久的移动到新URI，返回信息会包括新的URI，浏览器会自动定向到新URI。今后任何新的请求都应使用新的URI代替
- 302：临时移动。与301类似。但资源只是临时被移动。客户端应继续使用原有URI
- 303：查看其它地址。与301类似。使用GET和POST请求查看
- 304：未修改。所请求的资源未修改，服务器返回此状态码时，不会返回任何资源。客户端通常会缓存访问过的资源，通过提供一个头信息指出客户端希望只返回在指定日期之后修改的资源
- 400：客户端请求的语法错误，服务器无法理解
- 401：请求要求用户的身份认证
- 403：服务器理解请求客户端的请求，但是拒绝执行此请求
- 404：服务器无法根据客户端的请求找到资源（网页）。通过此代码，网站设计人员可设置"您所请求的资源无法找到"的个性页面
- 406：请求的资源的内容特性无法满足请求头中的条件，因而无法生成响应实体。 
- 500：服务器遇到了一个未曾预料的状况，导致了它无法完成对请求的处理。一般来说，这个问题都会在服务器的程序码出错时出现。
- 501：服务器不支持当前请求所需要的某个功能。当服务器无法识别请求的方法，并且无法支持其对任何资源的请求。